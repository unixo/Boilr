{% extends 'BoilrBundle:Default:template5-base.html.twig' %}
{% import "BoilrBundle:Common:macros.html.twig" as mymacro %}

{% block inner_block %}
<div class="span9">
  <div class="page-header">
    <h1>Associazione tecnico <small>all'intervento</small></h1>
  </div>

  <form id="form_unplanned_interv" action="{{ app.request.requestUri }}" method="post" {{ form_enctype(form) }} class="form-horizontal">
    {% include 'CraueFormFlowBundle:FormFlow:stepField.html.twig' %}

    <fieldset>
        <legend>Dettagli intervento</legend>

        {{ mymacro.fieldset_row('Cliente', interv.customer.fullName) }}
        {{ mymacro.fieldset_row('Data', interv.scheduledDate|date('d-m-Y H:i')) }}
        {% if interv.details | length == 1 %}
        <div><label>Impianto:</label><span>{{ interv.details[0].system.descr }}</span></div>
        <div><label>Tipo:</label><span>{{ interv.details[0].system.systemType.name }}</span></div>
        {% else %}
        <div>
            <table>
                <thead>
                    <tr>
                        <th>Matricola</th>
                        <th>Descrizione</th>
                        <th>Tipologia</th>
                        <th>Gruppo controlli</th>
                    </tr>
                </thead>
                <tbody>
                {% for detail in interv.details %}
                    <tr>
                        <td>{{ detail.system.code }}</td>
                        <td>{{ detail.system.descr }}</td>
                        <td>{{ detail.system.systemType.name }}</td>
                        <td>{{ detail.operationGroup.fullDescr }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </fieldset>

    {% if flow.getCurrentStep() == 1 %}
        <fieldset>
            <legend>Selezione installatore</legend>

            <div><label>Nominativo:</label>{{ form_widget(form.installer) }}</div>
        </fieldset>
    {% elseif flow.getCurrentStep() == 2 %}
         {% include 'BoilrBundle:Person:_anag.html.twig' with { 'person': interv.installer,
                                                                'allFields': false,
                                                                'title': 'Dati installatore' } %}
    {% endif %}

    {% include 'CraueFormFlowBundle:FormFlow:buttons.html.twig' %}

    {{ form_rest(form) }}
    {{ form_errors(form) }}
  </form>
</div>
{% endblock %}


{% block javascripts %}
{{ form_javascript(form) }}
{% endblock %}